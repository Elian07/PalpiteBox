{"ast":null,"code":"import { GoogleSpreadsheet } from \"google-spreadsheet\";\nimport moment from \"moment\";\nconst doc = new GoogleSpreadsheet(process.env.SHEET_DOC_ID);\n\nconst fromBase64 = value => {\n  const buff = Buffer.from(value, 'base64');\n  return buff.toString('ascii');\n};\n\nexport default (async (req, res) => {\n  const genCupon = () => {\n    const code = parseInt(moment().format('YYMMDDHHmmssSSS')).toString(16).toUpperCase();\n    return code.substr(0, 4) + '-' + code.substr(4, 4) + '-' + code.substr(8, 4);\n  };\n\n  try {\n    await doc.useServiceAccountAuth({\n      client_email: process.env.SHEET_CLIENT_EMAIL,\n      private_key: fromBase64(process.env.SHEET_PRIVATE_KEY)\n    });\n    await doc.loadInfo();\n    const sheet = doc.sheetsByIndex[1];\n    const data = JSON.parse(req.body);\n    const sheetConfig = doc.sheetsByIndex[2];\n    await sheetConfig.loadCells(\"A3:B3\");\n    const mostrarPromocaoCell = sheetConfig.getCell(2, 0);\n    const textoCell = sheetConfig.getCell(2, 1);\n    let Cupom = '';\n    let Promo = '';\n\n    if (mostrarPromocaoCell.value === 'VERDADEIRO') {\n      //TO DO gerar cupom\n      Cupom = genCupon();\n      Promo = textoCell.value;\n    }\n\n    await sheet.addRow({\n      Nome: data.Nome,\n      Email: data.Email,\n      Whatsapp: data.Whatsapp,\n      Nota: parseInt(data.Nota),\n      'Data Preenchimento': moment().format('DD/MM/YYYY HH:mm:ss'),\n      Cupom,\n      Promo\n    });\n    res.end(JSON.stringify({\n      showCoupon: Cupom !== '',\n      Cupom,\n      Promo\n    }));\n  } catch (err) {\n    console.log(err);\n    res.end('error');\n  }\n});","map":{"version":3,"sources":["/home/elian/Projeto-PalpiteBox/pages/api/save.js"],"names":["GoogleSpreadsheet","moment","doc","process","env","SHEET_DOC_ID","fromBase64","value","buff","Buffer","from","toString","req","res","genCupon","code","parseInt","format","toUpperCase","substr","useServiceAccountAuth","client_email","SHEET_CLIENT_EMAIL","private_key","SHEET_PRIVATE_KEY","loadInfo","sheet","sheetsByIndex","data","JSON","parse","body","sheetConfig","loadCells","mostrarPromocaoCell","getCell","textoCell","Cupom","Promo","addRow","Nome","Email","Whatsapp","Nota","end","stringify","showCoupon","err","console","log"],"mappings":"AAAA,SAASA,iBAAT,QAAkC,oBAAlC;AAEA,OAAOC,MAAP,MAAmB,QAAnB;AAEA,MAAMC,GAAG,GAAG,IAAIF,iBAAJ,CACVG,OAAO,CAACC,GAAR,CAAYC,YADF,CAAZ;;AAIA,MAAMC,UAAU,GAAGC,KAAK,IAAI;AAC1B,QAAMC,IAAI,GAAGC,MAAM,CAACC,IAAP,CAAYH,KAAZ,EAAmB,QAAnB,CAAb;AACA,SAAOC,IAAI,CAACG,QAAL,CAAc,OAAd,CAAP;AACD,CAHD;;AAIA,gBAAe,OAAMC,GAAN,EAAWC,GAAX,KAAmB;AAEhC,QAAMC,QAAQ,GAAG,MAAM;AACrB,UAAMC,IAAI,GAAGC,QAAQ,CAACf,MAAM,GAAGgB,MAAT,CAAgB,iBAAhB,CAAD,CAAR,CAA6CN,QAA7C,CAAsD,EAAtD,EAA0DO,WAA1D,EAAb;AACA,WAAOH,IAAI,CAACI,MAAL,CAAY,CAAZ,EAAc,CAAd,IAAmB,GAAnB,GAAyBJ,IAAI,CAACI,MAAL,CAAY,CAAZ,EAAc,CAAd,CAAzB,GAA4C,GAA5C,GAAkDJ,IAAI,CAACI,MAAL,CAAY,CAAZ,EAAc,CAAd,CAAzD;AACD,GAHD;;AAKE,MAAG;AACD,UAAMjB,GAAG,CAACkB,qBAAJ,CAA0B;AAC9BC,MAAAA,YAAY,EAAElB,OAAO,CAACC,GAAR,CAAYkB,kBADI;AAE9BC,MAAAA,WAAW,EAAEjB,UAAU,CAACH,OAAO,CAACC,GAAR,CAAYoB,iBAAb;AAFO,KAA1B,CAAN;AAIF,UAAMtB,GAAG,CAACuB,QAAJ,EAAN;AAEA,UAAMC,KAAK,GAAGxB,GAAG,CAACyB,aAAJ,CAAkB,CAAlB,CAAd;AACA,UAAMC,IAAI,GAAGC,IAAI,CAACC,KAAL,CAAWlB,GAAG,CAACmB,IAAf,CAAb;AAEA,UAAMC,WAAW,GAAG9B,GAAG,CAACyB,aAAJ,CAAkB,CAAlB,CAApB;AACA,UAAMK,WAAW,CAACC,SAAZ,CAAsB,OAAtB,CAAN;AACA,UAAMC,mBAAmB,GAAGF,WAAW,CAACG,OAAZ,CAAoB,CAApB,EAAuB,CAAvB,CAA5B;AACA,UAAMC,SAAS,GAAGJ,WAAW,CAACG,OAAZ,CAAoB,CAApB,EAAuB,CAAvB,CAAlB;AAEA,QAAIE,KAAK,GAAG,EAAZ;AACA,QAAIC,KAAK,GAAG,EAAZ;;AAEA,QAAGJ,mBAAmB,CAAC3B,KAApB,KAA8B,YAAjC,EAA8C;AAC5C;AACA8B,MAAAA,KAAK,GAAGvB,QAAQ,EAAhB;AACAwB,MAAAA,KAAK,GAAGF,SAAS,CAAC7B,KAAlB;AACD;;AACD,UAAMmB,KAAK,CAACa,MAAN,CAAa;AACfC,MAAAA,IAAI,EAAEZ,IAAI,CAACY,IADI;AAEfC,MAAAA,KAAK,EAAEb,IAAI,CAACa,KAFG;AAGfC,MAAAA,QAAQ,EAAEd,IAAI,CAACc,QAHA;AAIfC,MAAAA,IAAI,EAAE3B,QAAQ,CAACY,IAAI,CAACe,IAAN,CAJC;AAKf,4BAAsB1C,MAAM,GAAGgB,MAAT,CAAgB,qBAAhB,CALP;AAMfoB,MAAAA,KANe;AAOfC,MAAAA;AAPe,KAAb,CAAN;AASAzB,IAAAA,GAAG,CAAC+B,GAAJ,CAAQf,IAAI,CAACgB,SAAL,CAAe;AACrBC,MAAAA,UAAU,EAAET,KAAK,KAAK,EADD;AAErBA,MAAAA,KAFqB;AAGrBC,MAAAA;AAHqB,KAAf,CAAR;AAKC,GArCD,CAqCC,OAAMS,GAAN,EAAU;AACTC,IAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACAlC,IAAAA,GAAG,CAAC+B,GAAJ,CAAQ,OAAR;AACD;AACF,CAhDH","sourcesContent":["import { GoogleSpreadsheet } from \"google-spreadsheet\";\n\nimport moment from \"moment\";\n\nconst doc = new GoogleSpreadsheet(\n  process.env.SHEET_DOC_ID\n);\n\nconst fromBase64 = value => {\n  const buff = Buffer.from(value, 'base64')\n  return buff.toString('ascii')\n}\nexport default async(req, res) => {\n    \n  const genCupon = () => {\n    const code = parseInt(moment().format('YYMMDDHHmmssSSS')).toString(16).toUpperCase()\n    return code.substr(0,4) + '-' + code.substr(4,4) + '-' + code.substr(8,4)\n  }\n\n    try{\n      await doc.useServiceAccountAuth({\n        client_email: process.env.SHEET_CLIENT_EMAIL,\n        private_key: fromBase64(process.env.SHEET_PRIVATE_KEY)\n      })\n    await doc.loadInfo()\n    \n    const sheet = doc.sheetsByIndex[1]\n    const data = JSON.parse(req.body)\n\n    const sheetConfig = doc.sheetsByIndex[2];\n    await sheetConfig.loadCells(\"A3:B3\");\n    const mostrarPromocaoCell = sheetConfig.getCell(2, 0);\n    const textoCell = sheetConfig.getCell(2, 1);\n\n    let Cupom = ''\n    let Promo = ''\n\n    if(mostrarPromocaoCell.value === 'VERDADEIRO'){\n      //TO DO gerar cupom\n      Cupom = genCupon()\n      Promo = textoCell.value\n    }\n    await sheet.addRow({\n        Nome: data.Nome,\n        Email: data.Email,\n        Whatsapp: data.Whatsapp,\n        Nota: parseInt(data.Nota),\n        'Data Preenchimento': moment().format('DD/MM/YYYY HH:mm:ss'),\n        Cupom,\n        Promo\n    })\n    res.end(JSON.stringify({\n      showCoupon: Cupom !== '',\n      Cupom,\n      Promo\n    }))\n    }catch(err){\n      console.log(err)\n      res.end('error')\n    }\n  }   \n\n"]},"metadata":{},"sourceType":"module"}