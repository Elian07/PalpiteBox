{"ast":null,"code":"import { GoogleSpreadsheet } from \"google-spreadsheet\";\nimport moment from \"moment\";\nconst doc = new GoogleSpreadsheet(process.env.SHEET_DOC_ID);\nexport default (async (req, res) => {\n  const genCupon = () => {\n    const code = parseInt(moment().format('YYMMDDHHmmssSSS')).toString(16).toUpperCase();\n    return code.substr(0, 4) + '-' + code.substr(4, 4) + '-' + code.substr(8, 4);\n  };\n\n  try {\n    await doc.useServiceAccountAuth({\n      client_email: process.env.SHEET_CLIENT_EMAIL,\n      private_key: process.env.SHEET_PRIVATE_KEY\n    });\n    await doc.loadInfo();\n    const sheet = doc.sheetsByIndex[1];\n    const data = JSON.parse(req.body);\n    const sheetConfig = doc.sheetsByIndex[2];\n    await sheetConfig.loadCells(\"A3:B3\");\n    const mostrarPromocaoCell = sheetConfig.getCell(2, 0);\n    const textoCell = sheetConfig.getCell(2, 1);\n    let Cupom = '';\n    let Promo = '';\n\n    if (mostrarPromocaoCell.value === 'VERDADEIRO') {\n      //TO DO gerar cupom\n      Cupom = genCupon();\n      Promo = textoCell.value;\n    }\n\n    await sheet.addRow({\n      Nome: data.Nome,\n      Email: data.Email,\n      Whatsapp: data.Whatsapp,\n      Nota: parseInt(data.Nota),\n      'Data Preenchimento': moment().format('DD/MM/YYYY HH:mm:ss'),\n      Cupom,\n      Promo\n    });\n    res.end(JSON.stringify({\n      showCoupon: Cupom !== '',\n      Cupom,\n      Promo\n    }));\n  } catch (err) {\n    console.log(err);\n    res.end('error');\n  }\n});","map":{"version":3,"sources":["/home/elian/Projeto-PalpiteBox/pages/api/save.js"],"names":["GoogleSpreadsheet","moment","doc","process","env","SHEET_DOC_ID","req","res","genCupon","code","parseInt","format","toString","toUpperCase","substr","useServiceAccountAuth","client_email","SHEET_CLIENT_EMAIL","private_key","SHEET_PRIVATE_KEY","loadInfo","sheet","sheetsByIndex","data","JSON","parse","body","sheetConfig","loadCells","mostrarPromocaoCell","getCell","textoCell","Cupom","Promo","value","addRow","Nome","Email","Whatsapp","Nota","end","stringify","showCoupon","err","console","log"],"mappings":"AAAA,SAASA,iBAAT,QAAkC,oBAAlC;AAEA,OAAOC,MAAP,MAAmB,QAAnB;AAEA,MAAMC,GAAG,GAAG,IAAIF,iBAAJ,CACVG,OAAO,CAACC,GAAR,CAAYC,YADF,CAAZ;AAIA,gBAAe,OAAMC,GAAN,EAAWC,GAAX,KAAmB;AAEhC,QAAMC,QAAQ,GAAG,MAAM;AACrB,UAAMC,IAAI,GAAGC,QAAQ,CAACT,MAAM,GAAGU,MAAT,CAAgB,iBAAhB,CAAD,CAAR,CAA6CC,QAA7C,CAAsD,EAAtD,EAA0DC,WAA1D,EAAb;AACA,WAAOJ,IAAI,CAACK,MAAL,CAAY,CAAZ,EAAc,CAAd,IAAmB,GAAnB,GAAyBL,IAAI,CAACK,MAAL,CAAY,CAAZ,EAAc,CAAd,CAAzB,GAA4C,GAA5C,GAAkDL,IAAI,CAACK,MAAL,CAAY,CAAZ,EAAc,CAAd,CAAzD;AACD,GAHD;;AAKE,MAAG;AACD,UAAMZ,GAAG,CAACa,qBAAJ,CAA0B;AAC9BC,MAAAA,YAAY,EAAEb,OAAO,CAACC,GAAR,CAAYa,kBADI;AAE9BC,MAAAA,WAAW,EAAEf,OAAO,CAACC,GAAR,CAAYe;AAFK,KAA1B,CAAN;AAIF,UAAMjB,GAAG,CAACkB,QAAJ,EAAN;AAEA,UAAMC,KAAK,GAAGnB,GAAG,CAACoB,aAAJ,CAAkB,CAAlB,CAAd;AACA,UAAMC,IAAI,GAAGC,IAAI,CAACC,KAAL,CAAWnB,GAAG,CAACoB,IAAf,CAAb;AAEA,UAAMC,WAAW,GAAGzB,GAAG,CAACoB,aAAJ,CAAkB,CAAlB,CAApB;AACA,UAAMK,WAAW,CAACC,SAAZ,CAAsB,OAAtB,CAAN;AACA,UAAMC,mBAAmB,GAAGF,WAAW,CAACG,OAAZ,CAAoB,CAApB,EAAuB,CAAvB,CAA5B;AACA,UAAMC,SAAS,GAAGJ,WAAW,CAACG,OAAZ,CAAoB,CAApB,EAAuB,CAAvB,CAAlB;AAEA,QAAIE,KAAK,GAAG,EAAZ;AACA,QAAIC,KAAK,GAAG,EAAZ;;AAEA,QAAGJ,mBAAmB,CAACK,KAApB,KAA8B,YAAjC,EAA8C;AAC5C;AACAF,MAAAA,KAAK,GAAGxB,QAAQ,EAAhB;AACAyB,MAAAA,KAAK,GAAGF,SAAS,CAACG,KAAlB;AACD;;AACD,UAAMb,KAAK,CAACc,MAAN,CAAa;AACfC,MAAAA,IAAI,EAAEb,IAAI,CAACa,IADI;AAEfC,MAAAA,KAAK,EAAEd,IAAI,CAACc,KAFG;AAGfC,MAAAA,QAAQ,EAAEf,IAAI,CAACe,QAHA;AAIfC,MAAAA,IAAI,EAAE7B,QAAQ,CAACa,IAAI,CAACgB,IAAN,CAJC;AAKf,4BAAsBtC,MAAM,GAAGU,MAAT,CAAgB,qBAAhB,CALP;AAMfqB,MAAAA,KANe;AAOfC,MAAAA;AAPe,KAAb,CAAN;AASA1B,IAAAA,GAAG,CAACiC,GAAJ,CAAQhB,IAAI,CAACiB,SAAL,CAAe;AACrBC,MAAAA,UAAU,EAAEV,KAAK,KAAK,EADD;AAErBA,MAAAA,KAFqB;AAGrBC,MAAAA;AAHqB,KAAf,CAAR;AAKC,GArCD,CAqCC,OAAMU,GAAN,EAAU;AACTC,IAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACApC,IAAAA,GAAG,CAACiC,GAAJ,CAAQ,OAAR;AACD;AACF,CAhDH","sourcesContent":["import { GoogleSpreadsheet } from \"google-spreadsheet\";\n\nimport moment from \"moment\";\n\nconst doc = new GoogleSpreadsheet(\n  process.env.SHEET_DOC_ID\n);\n\nexport default async(req, res) => {\n    \n  const genCupon = () => {\n    const code = parseInt(moment().format('YYMMDDHHmmssSSS')).toString(16).toUpperCase()\n    return code.substr(0,4) + '-' + code.substr(4,4) + '-' + code.substr(8,4)\n  }\n\n    try{\n      await doc.useServiceAccountAuth({\n        client_email: process.env.SHEET_CLIENT_EMAIL,\n        private_key: process.env.SHEET_PRIVATE_KEY\n      })\n    await doc.loadInfo()\n    \n    const sheet = doc.sheetsByIndex[1]\n    const data = JSON.parse(req.body)\n\n    const sheetConfig = doc.sheetsByIndex[2];\n    await sheetConfig.loadCells(\"A3:B3\");\n    const mostrarPromocaoCell = sheetConfig.getCell(2, 0);\n    const textoCell = sheetConfig.getCell(2, 1);\n\n    let Cupom = ''\n    let Promo = ''\n\n    if(mostrarPromocaoCell.value === 'VERDADEIRO'){\n      //TO DO gerar cupom\n      Cupom = genCupon()\n      Promo = textoCell.value\n    }\n    await sheet.addRow({\n        Nome: data.Nome,\n        Email: data.Email,\n        Whatsapp: data.Whatsapp,\n        Nota: parseInt(data.Nota),\n        'Data Preenchimento': moment().format('DD/MM/YYYY HH:mm:ss'),\n        Cupom,\n        Promo\n    })\n    res.end(JSON.stringify({\n      showCoupon: Cupom !== '',\n      Cupom,\n      Promo\n    }))\n    }catch(err){\n      console.log(err)\n      res.end('error')\n    }\n  }   \n\n"]},"metadata":{},"sourceType":"module"}