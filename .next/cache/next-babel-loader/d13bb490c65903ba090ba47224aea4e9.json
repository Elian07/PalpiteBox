{"ast":null,"code":"import { GoogleSpreadsheet } from \"google-spreadsheet\";\nimport credentials from \"../../credentials.json\";\nimport moment from \"moment\";\nconst doc = new GoogleSpreadsheet(\"1G_U7ODPp3tY22lO5fhURhxCtos6VAvQcGUJvRMsX1eE\");\nexport default (async (req, res) => {\n  const genCupon = () => {\n    const code = parseInt(moment().format('YYMMDDHHmmssSSS')).toString(16).toUpperCase();\n    return code.substr(0, 4) + '-' + code.substr(4, 4) + '-' + code.substr(8, 4);\n  };\n\n  try {\n    await doc.useServiceAccountAuth(credentials);\n    await doc.loadInfo();\n    const sheet = doc.sheetsByIndex[1];\n    const data = JSON.parse(req.body);\n    const sheetConfig = doc.sheetsByIndex[2];\n    await sheetConfig.loadCells(\"A3:B3\");\n    const mostrarPromocaoCell = sheetConfig.getCell(2, 0);\n    const textoCell = sheetConfig.getCell(2, 1);\n    let Cupom = '';\n    let Promo = '';\n\n    if (mostrarPromocaoCell.value === 'VERDADEIRO') {\n      //TO DO gerar cupom\n      Cupom = genCupon();\n      Promo = textoCell.value;\n    }\n\n    await sheet.addRow({\n      Nome: data.Nome,\n      Email: data.Email,\n      Whatsapp: data.Whatsapp,\n      Nota: '5',\n      'Data Preenchimento': moment().format('DD/MM/YYYY HH:mm:ss'),\n      Cupom,\n      Promo\n    });\n    res.end(JSON.stringify({\n      showCoupon: Cupom !== '',\n      Cupom,\n      Promo\n    }));\n  } catch (err) {\n    console.log(err);\n    res.end('error');\n  }\n});","map":{"version":3,"sources":["/home/elian/Projeto-PalpiteBox/pages/api/save.js"],"names":["GoogleSpreadsheet","credentials","moment","doc","req","res","genCupon","code","parseInt","format","toString","toUpperCase","substr","useServiceAccountAuth","loadInfo","sheet","sheetsByIndex","data","JSON","parse","body","sheetConfig","loadCells","mostrarPromocaoCell","getCell","textoCell","Cupom","Promo","value","addRow","Nome","Email","Whatsapp","Nota","end","stringify","showCoupon","err","console","log"],"mappings":"AAAA,SAASA,iBAAT,QAAkC,oBAAlC;AAEA,OAAOC,WAAP,MAAwB,wBAAxB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AAEA,MAAMC,GAAG,GAAG,IAAIH,iBAAJ,CACV,8CADU,CAAZ;AAIA,gBAAe,OAAMI,GAAN,EAAWC,GAAX,KAAmB;AAEhC,QAAMC,QAAQ,GAAG,MAAM;AACrB,UAAMC,IAAI,GAAGC,QAAQ,CAACN,MAAM,GAAGO,MAAT,CAAgB,iBAAhB,CAAD,CAAR,CAA6CC,QAA7C,CAAsD,EAAtD,EAA0DC,WAA1D,EAAb;AACA,WAAOJ,IAAI,CAACK,MAAL,CAAY,CAAZ,EAAc,CAAd,IAAmB,GAAnB,GAAyBL,IAAI,CAACK,MAAL,CAAY,CAAZ,EAAc,CAAd,CAAzB,GAA4C,GAA5C,GAAkDL,IAAI,CAACK,MAAL,CAAY,CAAZ,EAAc,CAAd,CAAzD;AACD,GAHD;;AAKE,MAAG;AACH,UAAMT,GAAG,CAACU,qBAAJ,CAA0BZ,WAA1B,CAAN;AACA,UAAME,GAAG,CAACW,QAAJ,EAAN;AAEA,UAAMC,KAAK,GAAGZ,GAAG,CAACa,aAAJ,CAAkB,CAAlB,CAAd;AACA,UAAMC,IAAI,GAAGC,IAAI,CAACC,KAAL,CAAWf,GAAG,CAACgB,IAAf,CAAb;AAEA,UAAMC,WAAW,GAAGlB,GAAG,CAACa,aAAJ,CAAkB,CAAlB,CAApB;AACA,UAAMK,WAAW,CAACC,SAAZ,CAAsB,OAAtB,CAAN;AACA,UAAMC,mBAAmB,GAAGF,WAAW,CAACG,OAAZ,CAAoB,CAApB,EAAuB,CAAvB,CAA5B;AACA,UAAMC,SAAS,GAAGJ,WAAW,CAACG,OAAZ,CAAoB,CAApB,EAAuB,CAAvB,CAAlB;AAEA,QAAIE,KAAK,GAAG,EAAZ;AACA,QAAIC,KAAK,GAAG,EAAZ;;AAEA,QAAGJ,mBAAmB,CAACK,KAApB,KAA8B,YAAjC,EAA8C;AAC5C;AACAF,MAAAA,KAAK,GAAGpB,QAAQ,EAAhB;AACAqB,MAAAA,KAAK,GAAGF,SAAS,CAACG,KAAlB;AACD;;AACD,UAAMb,KAAK,CAACc,MAAN,CAAa;AACfC,MAAAA,IAAI,EAAEb,IAAI,CAACa,IADI;AAEfC,MAAAA,KAAK,EAAEd,IAAI,CAACc,KAFG;AAGfC,MAAAA,QAAQ,EAAEf,IAAI,CAACe,QAHA;AAIfC,MAAAA,IAAI,EAAC,GAJU;AAKf,4BAAsB/B,MAAM,GAAGO,MAAT,CAAgB,qBAAhB,CALP;AAMfiB,MAAAA,KANe;AAOfC,MAAAA;AAPe,KAAb,CAAN;AASAtB,IAAAA,GAAG,CAAC6B,GAAJ,CAAQhB,IAAI,CAACiB,SAAL,CAAe;AACrBC,MAAAA,UAAU,EAAEV,KAAK,KAAK,EADD;AAErBA,MAAAA,KAFqB;AAGrBC,MAAAA;AAHqB,KAAf,CAAR;AAKC,GAlCD,CAkCC,OAAMU,GAAN,EAAU;AACTC,IAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACAhC,IAAAA,GAAG,CAAC6B,GAAJ,CAAQ,OAAR;AACD;AACF,CA7CH","sourcesContent":["import { GoogleSpreadsheet } from \"google-spreadsheet\";\n\nimport credentials from \"../../credentials.json\";\nimport moment from \"moment\";\n\nconst doc = new GoogleSpreadsheet(\n  \"1G_U7ODPp3tY22lO5fhURhxCtos6VAvQcGUJvRMsX1eE\"\n);\n\nexport default async(req, res) => {\n    \n  const genCupon = () => {\n    const code = parseInt(moment().format('YYMMDDHHmmssSSS')).toString(16).toUpperCase()\n    return code.substr(0,4) + '-' + code.substr(4,4) + '-' + code.substr(8,4)\n  }\n\n    try{\n    await doc.useServiceAccountAuth(credentials)\n    await doc.loadInfo()\n    \n    const sheet = doc.sheetsByIndex[1]\n    const data = JSON.parse(req.body)\n\n    const sheetConfig = doc.sheetsByIndex[2];\n    await sheetConfig.loadCells(\"A3:B3\");\n    const mostrarPromocaoCell = sheetConfig.getCell(2, 0);\n    const textoCell = sheetConfig.getCell(2, 1);\n\n    let Cupom = ''\n    let Promo = ''\n\n    if(mostrarPromocaoCell.value === 'VERDADEIRO'){\n      //TO DO gerar cupom\n      Cupom = genCupon()\n      Promo = textoCell.value\n    }\n    await sheet.addRow({\n        Nome: data.Nome,\n        Email: data.Email,\n        Whatsapp: data.Whatsapp,\n        Nota:'5',\n        'Data Preenchimento': moment().format('DD/MM/YYYY HH:mm:ss'),\n        Cupom,\n        Promo\n    })\n    res.end(JSON.stringify({\n      showCoupon: Cupom !== '',\n      Cupom,\n      Promo\n    }))\n    }catch(err){\n      console.log(err)\n      res.end('error')\n    }\n  }   \n\n"]},"metadata":{},"sourceType":"module"}